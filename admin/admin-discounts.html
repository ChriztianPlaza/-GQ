<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GQ Barbershop - Discount Management</title>
  <link rel="stylesheet" href="admin-styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body class="dashboard-page">
  <header class="dashboard-header">
    <div class="logo-section">
      <img src="gq-logo.jpg" alt="GQ Logo" class="side-logo" />
      <span class="brand-title">GQ BARBERSHOP ADMIN</span>
    </div>
    <nav class="dashboard-nav">
      <a href="admin-dashboard.html">Dashboard</a>
      <a href="admin-queue.html">Queue Management</a>
      <a href="admin-bookings.html">Bookings</a>
      <a href="admin-barbers.html">Staff Tracker</a>
      <a href="admin-services.html">Services</a>
      <a href="admin-customers.html">Customers</a>
      <a href="admin-discounts.html" class="active">Discounts</a>
      <a href="admin-reports.html">Reports</a>
    </nav>
    <div class="profile-section">
      <div class="profile-dropdown">
        <button class="profile-btn"><i class="fa-regular fa-user"></i></button>
        <div class="dropdown-menu">
          <a href="admin-profile.html">Profile</a>
          <a href="admin-settings.html">Settings</a>
          <button onclick="logout()">Logout</button>
        </div>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    <div class="page-header">
      <h1 class="page-title">Discount Management</h1>
      <div class="page-actions">
        <button class="btn btn-primary" onclick="addDiscount()">
          <i class="fas fa-plus"></i>
          Add Discount
        </button>
        <button class="btn btn-secondary" onclick="exportDiscounts()">
          <i class="fas fa-download"></i>
          Export
        </button>
        <button class="btn btn-danger" onclick="deleteSelected()" style="display: none;">
          <i class="fas fa-trash"></i>
          Delete Selected
        </button>
      </div>
    </div>

    <!-- Discount Statistics -->
    <div class="metrics-grid">
      <div class="metric-card total-discounts">
        <div class="metric-icon">
          <i class="fas fa-percent"></i>
        </div>
        <div class="metric-content">
          <h3>Total Discounts Today</h3>
          <div class="metric-number" id="total-discounts-count">0</div>
          <div class="metric-status">Applied today</div>
        </div>
      </div>

      <div class="metric-card senior-discounts">
        <div class="metric-icon">
          <i class="fas fa-user-friends"></i>
        </div>
        <div class="metric-content">
          <h3>Senior Discounts</h3>
          <div class="metric-number" id="senior-discounts-count">0</div>
          <div class="metric-status">20% off</div>
        </div>
      </div>

      <div class="metric-card pwd-discounts">
        <div class="metric-icon">
          <i class="fas fa-wheelchair"></i>
        </div>
        <div class="metric-content">
          <h3>PWD Discounts</h3>
          <div class="metric-number" id="pwd-discounts-count">0</div>
          <div class="metric-status">20% off</div>
        </div>
      </div>

      <div class="metric-card tenant-discounts">
        <div class="metric-icon">
          <i class="fas fa-building"></i>
        </div>
        <div class="metric-content">
          <h3>SM Tenant Discounts</h3>
          <div class="metric-number" id="tenant-discounts-count">0</div>
          <div class="metric-status">20% off</div>
        </div>
      </div>
    </div>

    <!-- Discount Filters -->
    <div class="filter-section">
      <div class="filter-group">
        <label>Discount Type:</label>
        <select id="discount-type-filter" onchange="filterDiscounts()">
          <option value="all">All Types</option>
          <option value="senior">Senior</option>
          <option value="pwd">PWD</option>
          <option value="tenant">SM Tenant</option>
        </select>
      </div>
      <div class="filter-group">
        <label>Start Date:</label>
        <input type="date" id="start-date" class="date-input">
      </div>
      <div class="filter-group">
        <label>End Date:</label>
        <input type="date" id="end-date" class="date-input">
      </div>
      <div class="filter-group">
        <label>&nbsp;</label>
        <button class="btn btn-primary" onclick="applyDateFilter()">Apply Filter</button>
      </div>
      <div class="filter-group">
        <label>&nbsp;</label>
        <input type="text" placeholder="Search..." class="search-input" id="discount-search">
      </div>
    </div>

    <!-- Discount Transactions Table -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Discount Transactions</h2>
        <div class="table-actions">
          <button class="btn btn-secondary" onclick="refreshDiscounts()">
            <i class="fas fa-sync-alt"></i>
            Refresh
          </button>
        </div>
      </div>
      
      <div class="table-container">
        <table class="data-table" id="discounts-table">
          <thead>
            <tr>
              <th>
                <input type="checkbox" id="select-all" onchange="toggleSelectAll()">
              </th>
              <th>Cost No.</th>
              <th>Name</th>
              <th>Type</th>
              <th>ID No.</th>
              <th>Original Total</th>
              <th>Discounted</th>
              <th>Final</th>
              <th>Date</th>
              <th>Barber</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Discount data will be loaded here -->
          </tbody>
        </table>
      </div>
    </div>

    <!-- Summary Section -->
    <div class="dashboard-section">
      <div class="section-header">
        <h2>Today's Summary</h2>
      </div>
      
      <div class="summary-grid">
        <div class="summary-card">
          <h4>Total Discount Amount</h4>
          <div class="summary-amount" id="total-discount-amount">₱0</div>
          <div class="summary-count" id="total-discount-count-summary">0 transactions</div>
        </div>

        <div class="summary-card">
          <h4>Revenue Loss</h4>
          <div class="summary-amount" id="revenue-loss">₱0</div>
          <div class="summary-count">Due to discounts</div>
        </div>

        <div class="summary-card">
          <h4>Most Used Discount</h4>
          <div class="summary-type" id="most-used-discount">Senior</div>
          <div class="summary-percentage" id="most-used-percentage">0% of transactions</div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Discount Modal -->
  <div id="discount-modal" class="modal-overlay">
    <div class="modal-container">
      <div class="modal-header">
        <h3>Add Discounted Transaction</h3>
        <button class="modal-close" onclick="closeDiscountModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      <div class="modal-content">
        <form id="discount-form">
          <div class="form-group">
            <label for="queue-number">Queue Number (Last 3 digits):</label>
            <input type="text" id="queue-number" maxlength="3" placeholder="Enter last 3 digits" oninput="searchCustomerByNumber(this.value)" required>
            <small class="form-helper">Enter the last 3 digits of the customer's queue number</small>
          </div>

          <div class="form-group">
            <label for="customer-name">Customer Name:</label>
            <input type="text" id="customer-name" placeholder="Customer name" required>
          </div>

          <div class="form-group">
            <label for="discount-type">Discount Type:</label>
            <select id="discount-type" onchange="updateDiscountInfo()" required>
              <option value="">Select discount type</option>
              <option value="senior">Senior Citizen (20% off)</option>
              <option value="pwd">PWD (20% off)</option>
              <option value="tenant">SM Tenant (20% off)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="id-number">ID Number:</label>
            <input type="text" id="id-number" placeholder="Enter ID number" oninput="generateTransactionId()" required>
            <small class="form-helper">Enter the customer's ID number</small>
          </div>

          <div class="form-group">
            <label for="original-total">Original Total:</label>
            <input type="number" id="original-total" step="0.01" placeholder="0.00" oninput="calculateDiscount()" required readonly>
            <small class="form-helper">This will be auto-filled from customer data</small>
          </div>

          <div class="form-group">
            <label for="assigned-barber">Assigned Barber:</label>
            <input type="text" id="assigned-barber" placeholder="Barber name" required readonly>
            <small class="form-helper">This will be auto-filled from customer data</small>
          </div>

          <div class="form-group">
            <label for="transaction-id">Transaction ID:</label>
            <input type="text" id="transaction-id" placeholder="Transaction ID" readonly>
            <small class="form-helper">Auto-generated from ID number</small>
          </div>

          <div class="discount-summary">
            <div class="summary-row">
              <span>Original Total:</span>
              <span id="display-original">₱0.00</span>
            </div>
            <div class="summary-row">
              <span>Discount (20%):</span>
              <span id="display-discount">₱0.00</span>
            </div>
            <div class="summary-row total">
              <span>Final Total:</span>
              <span id="display-final">₱0.00</span>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" onclick="closeDiscountModal()">Cancel</button>
        <button type="submit" form="discount-form" class="btn btn-primary">Add Transaction</button>
      </div>
    </div>
  </div>

  <script src="admin-script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      if (!checkAuth()) {
        window.location.href = 'admin-index.html';
        return;
      }
      initDiscountManagement();
    });
  </script>
</body>
</html>